<!DOCTYPE html>
<html lang="en">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta charset="utf-8" />
  <title>DreamCatcher Emoji Edition</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      background: #000;
    }
  </style>
</head>
<body>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/phaser/2.6.2/phaser.min.js"></script>
  <script>
    const GalaxyGem = new Phaser.Game(1280, 720, Phaser.CANVAS);
    let EstadosGalaxyGem = {
      preload: function () {},
      create: function () {
        // Fondo de emojis de baqueros 🌄 grande
        let bgText = '';
        for (let y = 0; y < 10; y++) {
          for (let x = 0; x < 22; x++) {
            bgText += '🌄';
          }
          bgText += '\n';
        }
        this.bg = this.add.text(0, 0, bgText, {
          font: '72px Arial', fill: '#fff'
        });
        this.bg.alpha = 0.1;

        // Nave jugador 🔫
        this.nave = this.add.text(this.world.centerX, this.world.centerY, '🔫', {
          font: '72px Arial'
        });
        this.nave.anchor.setTo(0.5);

        // Cursor
        this.cursor = this.input.keyboard.createCursorKeys();

        // Balas 🔥
        this.bullets = this.add.group();
        this.bulletTime = 0;
        this.bulletInterval = 100; // Disparo continuo más rápido

        // Meteoritos 🎯
        this.meteoritos = [];
        for (let i = 0; i < 50; i++) {
          let m = this.add.text(Math.random() * 1200, Math.random() * -1000, '🎯', {
            font: '48px Arial'
          });
          m.anchor.setTo(0.5);
          m.vel = 2 + Math.random() * 3;
          this.meteoritos.push(m);
        }

        // Meteoritos indestructibles 🎯 (más grandes)
        this.indestructibles = [];
        for (let i = 0; i < 10; i++) {
          let m = this.add.text(Math.random() * 1200, Math.random() * -1000, '🎯', {
            font: '96px Arial'
          });
          m.anchor.setTo(0.5);
          m.vel = 2 + Math.random() * 3;
          this.indestructibles.push(m);
        }

        // Monedas 🪙 (50 total)
        this.monedas = [];
        for (let i = 0; i < 50; i++) {
          let m = this.add.text(Math.random() * 1200, Math.random() * -800, '🪙', {
            font: '48px Arial'
          });
          m.anchor.setTo(0.5);
          m.vel = 2 + Math.random() * 2;
          this.monedas.push(m);
        }

        // Vida con ♦️♥️♣️♠️
        this.vida = 4;
        this.vidaText = this.add.text(50, 20, this.getVidaStr(), {
          font: '24pt Arial', fill: '#fff'
        });

        // Score
        this.score = 0;
        this.scoreText = this.add.text(1000, 20, '🪙 x 0', {
          font: '24pt Arial', fill: '#fff'
        });
      },

      getVidaStr: function () {
        return 'Vida: ' + '♦️♥️♣️♠️'.slice(0, this.vida);
      },

      update: function () {
        if (this.cursor.left.isDown) this.nave.x -= 10;
        if (this.cursor.right.isDown) this.nave.x += 10;
        if (this.cursor.up.isDown) this.nave.y -= 10;
        if (this.cursor.down.isDown) this.nave.y += 10;

        // Disparo automático continuo
        if (this.time.now > this.bulletTime) {
          let b = this.bullets.create(this.nave.x, this.nave.y, '');
          b.anchor = new Phaser.Point(0.5, 0.5);
          b.text = this.add.text(0, 0, '🔥', { font: '36px Arial' });
          b.text.anchor.set(0.5);
          b.addChild(b.text);
          b.update = function () {
            this.y -= 15;
            if (this.y < -50) this.destroy();
          };
          this.bulletTime = this.time.now + this.bulletInterval;
        }

        this.bullets.forEachAlive(b => b.update(), this);

        this.meteoritos.forEach(m => {
          m.y += m.vel;
          if (m.y > 800) m.y = Math.random() * -500;
          this.bullets.forEachAlive(b => {
            if (Phaser.Rectangle.intersects(m.getBounds(), b.getBounds())) {
              m.y = Math.random() * -800;
              b.destroy();
              this.score++;
              this.scoreText.text = '🪙 x ' + this.score;
            }
          });
        });

        this.indestructibles.forEach(m => {
          m.y += m.vel;
          if (m.y > 800) m.y = Math.random() * -800;
          if (Phaser.Rectangle.intersects(m.getBounds(), this.nave.getBounds())) {
            if (this.vida > 0) this.vida--;
            this.vidaText.text = this.getVidaStr();
            if (this.vida <= 0) {
              alert('¡Perdiste!');
              location.reload();
            }
            m.y = Math.random() * -800;
          }
        });

        this.monedas.forEach(m => {
          m.y += m.vel;
          if (m.y > 800) m.y = Math.random() * -800;
          if (Phaser.Rectangle.intersects(m.getBounds(), this.nave.getBounds())) {
            m.y = Math.random() * -800;
            this.score++;
            this.scoreText.text = '🪙 x ' + this.score;
          }
        });
      }
    };

    alert("¡Da click en el centro de la pantalla para jugar!\nPresiona F5 para reiniciar el juego\nUtiliza las direccionales para moverte");
    GalaxyGem.state.add('MiJuegoGG', EstadosGalaxyGem);
    GalaxyGem.state.start('MiJuegoGG');
  </script>
</body>
</html>
